<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>My Hugging Face Chat</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
    #chat { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: auto; background: #f9f9f9; }
    .msg-user { color: blue; margin: 5px 0; font-weight: bold; }
    .msg-bot { color: green; margin: 5px 0; }
    .msg-error { color: red; margin: 5px 0; }
    #inputArea { margin-top: 10px; display: flex; gap: 5px; }
    #userInput { flex: 1; padding: 5px; }
    #tokenInput { margin: 10px 0; padding: 10px; border: 1px solid #ddd; background: #f0f0f0; }
    .info-text { color: #666; font-size: 12px; }
  </style>
</head>
<body>
  <h2>Chat with HF Model</h2>
  <div id="tokenInput">
    <label>HF API Token: <input type="password" id="hfToken" placeholder="Enter your HF token..." value="tok_70a5565fc132f0b1db75300f24d8e1da" /></label>
    <p class="info-text">Token is stored locally in your browser. Not sent to any server.</p>
  </div>
  <div id="chat"></div>
  <div id="inputArea">
    <input id="userInput" type="text" placeholder="Type your message..." />
    <button onclick="sendMessage()">Send</button>
  </div>

  <script>
    const MODEL_ID = "mistralai/Mistral-7B-Instruct-v0.2";
    const chatDiv = document.getElementById("chat");
    const userInput = document.getElementById("userInput");
    const tokenInput = document.getElementById("hfToken");

    function getToken() {
      return tokenInput.value.trim();
    }

    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;
      
      const token = getToken();
      if (!token) {
        addMessage("Error: Please enter your HF API token", "msg-error");
        return;
      }

      addMessage("You: " + text, "msg-user");
      userInput.value = "";

      const loadingElem = addMessage("Assistant: ...", "msg-bot");
      try {
        const response = await fetch(
          "https://api-inference.huggingface.co/models/" + MODEL_ID,
          {
            method: "POST",
            headers: {
              "Authorization": "Bearer " + token,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              inputs: text,
              parameters: {
                max_new_tokens: 200,
                temperature: 0.7
              }
            })
          }
        );

        const data = await response.json();
        let reply = "";
        
        if (!response.ok) {
          reply = "Error: " + (data.error || "API request failed");
        } else if (Array.isArray(data) && data[0] && data[0].generated_text) {
          reply = data[0].generated_text;
        } else if (data.error) {
          reply = "Error: " + data.error;
        } else {
          reply = JSON.stringify(data);
        }
        updateMessage(loadingElem, "Assistant: " + reply);
      } catch (e) {
        updateMessage(loadingElem, "Assistant: Error calling API: " + e.message);
      }
    }

    function addMessage(text, cls) {
      const p = document.createElement("p");
      p.className = cls;
      p.textContent = text;
      chatDiv.appendChild(p);
      chatDiv.scrollTop = chatDiv.scrollHeight;
      return p;
    }

    function updateMessage(element, newText) {
      element.textContent = newText;
      chatDiv.scrollTop = chatDiv.scrollHeight;
    }

    userInput.addEventListener("keyup", function(e) {
      if (e.key === "Enter") sendMessage();
    });
  </script>
</body>
</html>
